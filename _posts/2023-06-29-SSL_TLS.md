---
layout: post
title: "SSL/TLS and Modular Encryption"
categories: security
---

## asymmetry

공개키/비공개키 암호화 방식은 비대칭 암호화라고도 부른다.

공개키로 암호화한 데이터는 비공개키로만 복호화 할 수 있고

반대로 비공개키로 암호화한 데이터는 공개키로만 복호화 할 수 있다.

암/복호화 시 서로 어긋나는 키를 사용해서 그렇게 부른다.

## principle

어떤 수학적 도구를 사용하기에 이런 비대칭 키가 동작할까?

나머지를 구하는 mod 연산을 통해 가능해졌다.

몇가지 mod 연산 예시를 보자.

36 = 6 mod 10 

36을 10으로 mod하면 나머지 6 이 나온다고 읽는다.

15를 7로 mod하면 나머지 1 이 나오고 15 = 1 mod 7 로 쓴다.

이제 실제 키 생성에 사용하는 modular inverse (역원)를 보자.

1/7 같은 수를 10으로 mod 하면 어떤 값이 나올까?

무작정 (1/7) / 10 로 쓰고 보면 1/70 인데 나머지가 있을까?

mod 연산의 나눗셈은 역원을 곱해주는 것을 나눗셈으로 쳐준다.

역원이 포함 된 modular 연산은 ax ≡ 1 mod N 이며 x 는 a^-1 이다. 

즉 (1/7) = ▲ mod 10 일때 위 식을 사용해 ▲ * 7 = 1 mod 10 로 

역원을 알때 ▲ 를 찾는 식이다.

(1/7)로 역원을 찾아 역원이 들어간 공식으로 바꿔 역원에 얼마를 곱해야 

원래의 수가 나오는지를 찾는게 처음보면 이상해 보이는 모듈러 연산의 나눗셈이다.

▲ * 7 = 1 mod 10 에서 ▲ 는 3으로 암산으로도 가능한다.

▲ * 789 = 1 mod 92839283928982932 에서 ▲ 를 찾기는 어렵다.

공개키는 mod 수와 역원을 공개하여 ▲ 를 암호화하는 걸 말한다. 

mod 수와 역원을 알더라도 ▲ 를 구하기는 어렵고 비밀키를 가진 사람만이

▲ 를 구할 수 있기 때문이다.

## problem

내 공개키를 인터넷에 공개하여 내게 비밀 메세지를 보내고 싶은 타인은

내 공개키로 비밀 메세지를 암호화하여 내게 전송하면 된다.

전송 과정에서 암호화 된 비밀 메세지가 인터넷에 공개 되어도 비공개키를 가진 

나만이 비밀 메세지를 복화화해서 읽을 수 있다.

그런데 애초에 인터넷에 공개된 내 공개키가 가짜라면 내게 비밀 메세지를 

보내고 싶은 상대는 가짜를 나인줄 알고 가짜 공개키로 자신의 비밀 메세지를 

암호화해서 가짜에게 보내는 치명적인 문제가 발생 할 수 있다.

## certificate

인증서는 인터넷에 공개된 내 공개키가 내가 공개한 키가 맞다는걸 서명을 통해 

보증해준다.

서명은 신뢰 할 수 있는 기관의 서명으로 내가 공개키를 공개하고 싶을 때 

신뢰 할 수 있는 기관에 인증서 발급 요청시 내 신원 확인 후 내 공개키와 

내 신원 정보을 메세지로 기관의 비밀키로 암호화하여 생성한다.

개인의 PC는 신뢰 할 수 있는 기관의 공개키를 OS 설치 시점부터 이미 가지고 있어

내가 공개한 인증서에 서명된 기관의 공개키를 찾아 복호화한 후 내가 공개한

인증서임을 확인하고 동봉된 내 공개키로 비밀 메세지를 암호화해 안전하게 

전달 할 수 있다.


## SSL/TLS

인터넷에 공개된 인증서는 SSL/TLS 프로토콜을 통해 확인 검증된다.

클라이언트와 서버는 서로간의 프로토콜 버전 및 사용 가능한 암호화 알고리즘 

등을 확인하고 인증서의 서명을 검증한다. 

https의 경우 서버 인증서만 확인 후 통신하며 은행 업무 같은 경우 쌍빵의

인증서를 서로 확인한다.

SSL/TLS는 인증서 확인후 일회용 대칭 비밀키를 생성하여 공개키로 암호화

전송한 후 이후부턴 가벼운 대칭 비밀키로 암호화하여 데이터를 주고 받는다.

- [modular calculator](https://planetcalc.com/8326/)



























