---
layout: post
title: "TBN matrics"
categories: c++
---

## Tangent Space

조명 계산에 가장 기본인 NDotL은 빛이 입사하는 표면의 밝기를 결정하는 데 

사용되고 수식은 아래와 같다.

\\( NDotL = N · L \\)

이때 빛의 방향(L)에 대한 표면 법선(N) 벡터는 버텍스마다 가질 수 있는데

버텍스와 버텍스 사이는 보간 값을 사용하여 빛의 밝기를 결정한다.

따라서 버텍스 간 빛의 반응에 대한 디테일이 떨어질 수 있는데 

이를 보완하기 위해 픽셀 단위로 N 값을 가질 수 있도록 노멀 맵에 저장 후 

픽셀 쉐이더에서 셈플링하여 디테일을 올릴 수 있다.

이때 노멀 맵의 각 텍셀에는 오브젝트 공간 상 표면의 법선 벡터 값이 아닌

텍스쳐 공간(tangent space)상의 표면의 법선 벡터 값으로 저장된다.

그럼 여기서 말하는 텍스쳐 공간이란 무엇이고 왜 필요할까?

어째서 오브젝트 공간에서 표현된 표면 법선 벡터를 사용하지 않고 

생소한 텍스쳐 공간상 법선 벡터를 노멀 맵 텍셀에 저장할까?

픽셀 쉐이더에서 오프젝트 공간상 표현된 법선 벡터를 셈플링하여 

월드 공간으로 변환한 뒤 같은 월드 공간의 빛 방향 벡터와 NDotL을 

구하여 사용하면 안 되는 이유는 무얼까?

만약 오프젝트가 본에 스킨닝 되어 애니메이팅 되는 상황을 가정해 보자.

애니메이팅 된 오브젝트는 모델링 시점의 모양과 다른 형태이고

이 상태의 픽셀 쉐이더에서 샘플링한 표면 법선 벡터는 

애니메이팅 되기전 표면의 법선 벡터이다.

이는 애니메이팅으로 변형된 오브젝트의 표면 법선 벡터가 아닌

모델링 시점의 법선 벡터이고 이는 잘 못 된 빛 계산을 초래하게 된다.

텍스쳐 공간은 각 텍셀마다 고유의 기준 벡터를 가지며,

그 기준 벡터를 통해 표면의 법선 벡터가 정의 된다.

따라서 오브젝트가 애니메이팅 되어 변형된다고 하여도 텍스쳐상 존재하는 표면의

법선 벡터는 영향을 받지 않게 된다.

<!-- begin_excerpt -->

이러한 특성으로 인해 표면의 노멀 벡터는 텍스쳐 공간으로 변환하여 저장한다.

<!-- end_excerpt -->