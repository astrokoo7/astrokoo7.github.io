---
layout: post
title: "Return Value Optimization in C++"
categories: c++
---

```
int[] foo();
```

<!-- begin_excerpt -->
c++에서 함수 반환 값 타입으로 int[ ] 같은 배열 타입은 지정할 수 없다. 

왜 그럴까?
<!-- end_excerpt -->

```
void foo()
{
    int i[];
    ...
}

```

한편, 배열을 선언할 때 위와 같이 크기를 지정 안 하면 오류가 발생하는데, <br>
이는 컴파일러가 함수 호출 시 로컬 변수의 크기를 알 수 없어 얼마 만큼의 스택 공간을 미리 할당해야 할지 몰라서 발생하는 오류이다. 즉, 컴파일 타임에 배열의 크기는 알려져 있어야 한다.

> <font size="2"> 
> 동적 배열을 사용하면 컴파일 타임에 배열의 크기를 몰라도 된다. 
> 동적 배열은 런타임에 스택이 아닌 힙에 할당되고 그 주소를 컴파일 타임에 잡은 스택에서 가리킨다.
> </font>

함수의 반환 값 타입으로 `int[]`가 안되는 이유는 `int i[];` 오류와 같은 이유로 컴파일 타임에 스택의 크기를 정할 수 없기 때문이다.

다시 말해, 반환 값의 크기는 컴파일 타임에 알려져 있어야 한다.

## RVO

RVO는 컴파일러가 컴파일 타임에 반환 값의 크기를, 앞에서 이야기했듯, 미리 알 수 있기 때문에 코드의 맥락에 따라 자동으로 최적화 해주는 방식을 말한다.


...