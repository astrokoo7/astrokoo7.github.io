---
layout: post
title: "Why use a socket broadcast server?"
categories: c++
---

왜 MMORPG 서버는 로직 서버 앞단에 소켓 방송 서버를 따로 두어 사용할까?

<!-- begin_excerpt -->

모든 물리적 장치와 사용자 프로세스 간에는 버퍼가 존재한다.

<!-- end_excerpt -->

프로세스는 물리적 장치를 사용하기 위해선 커널의 스케줄링을 따라 버퍼를 통하여 데이터를 주고받으며 사용한다.

네트웍 장치의 경우 os 커널은 소켓이란 논리적 단위로 처리한다. 

소켓은 버퍼를 가지고 있고 유저는 버퍼에 데이터를 쓰거나 읽어서 네트웍 통신을 한다.

버퍼에 읽거나 쓸 때 커널 영역의 데이터를 유저 영역으로 복사한다.

만약 엄청나게 많은 유저를 받아 처리하는 서버가 있다고 생각해 보자.

각각의 유저는 네트웍 통신을 위해 저마다 소켓을 통해 데이터를 복사하며 주고받는다.

n 명의 유저가 n 개의 소켓에 저마다 필요에 의해 커널 영역의 데이터를 유저 영역으로 복사한다면

유저가 증가할수록 비용은 O(n^2)이 될 수 있다.

n 명의 유저의 네트웍 입력 출력을 따로 받는 전용 서버가 있고 뒷단의 서버는 적은 소켓을 통해 데이터를 받는다면 어떨까?

로직 전용 서버는 배치 효과를 통한 이득이 있고 

소켓 방송 서버가 윈도우라면 IOCP를 통한 OS 영역의 매모리를 유저 프로세스가 mapping하여 커널 버퍼와 유저 간 zero copy의 이득을 볼 수 있을 것이다.

마치 erlang이 mmap을 통해 new 를 재정의 한 것처럼..
